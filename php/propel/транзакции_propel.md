# Транзакции в Propel

По данному вопросу информации на английском языке - достаточно. Но столкнувшись с ним 
на "живой" задаче, понял, что не все моменты достаточно ясны при беглом прочтении документации
и тьюториалов.

## Обертка запросов внутри транзакции

(практически вольный перевод http://propelorm.org/Propel/documentation/06-transactions.html)
В оригинале решение отлично описано, но при применении у меня возникли проблемы с одним моментом,
по большей части из-за невнимательности. Поэтому я написал свой пример с комментариями

```php
/**
 * Создаем объект соединения.
 * \Propel\Runtime\Propel - тут все понятно, путь до класса.
 * \Model\Money\Map\CoinsTableMap - путь до класса с методами 
 * для работы с нашей таблицей. Оттуда нужна константа DATABASE_NAME
 */
$dbCon = \Propel\Runtime\Propel::getWriteConnection(\Model\Money\Map\CoinsTableMap::DATABASE_NAME);

/**
 * Вызываем метод, обозначающий начало транзакции
 */
$dbCon->beginTransaction();

foreach ($coinsArray as $coinsItem) {
    try {
    	/**
    	 * Создаем объект отношений с сущностью Coins
    	 */
        $coins = new Coins();
        $coins->setCurrencyId($coinsArray['id']);
        /**
         * Передаем в метод save обект соединения с базой
         */
        $coins->save($dbCon);
    } catch (Exception $e) {
    	/**
    	 * Здесь происходит самое интересное, в исключения попадают ошибки субд,
    	 * мы их ловим и с помощью метода rollback() убираем предыдущий запрос
    	 * к базе.
    	 */
        $dbCon->rollBack();
        continue;
    }
}

/**
 * Отправляем транзакцию исполняться.
 */
$dbCon->commit();
```
